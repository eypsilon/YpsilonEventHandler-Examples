<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Handler System Demo - Revolutionary Event Delegation</title>
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="stylesheet" type="text/css" href="./assets/main.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 40px 40px 200px;
            background: white;
            border: 3px solid #4CAF50;
            position: relative;
        }

        body::before {
            content: 'BODY Handler';
            position: absolute;
            top: 5px;
            left: 10px;
            color: #4CAF50;
            font-weight: bold;
            font-size: 12px;
        }

        #app {
            padding: 40px;
            background: #f5f5f5;
            border: 3px solid #2196F3;
            position: relative;
            margin: 20px 0;
        }

        #app::before {
            content: 'APP Handler';
            position: absolute;
            top: 5px;
            left: 10px;
            color: #2196F3;
            font-weight: bold;
            font-size: 12px;
        }

        #main {
            padding: 40px;
            background: #e8e8e8;
            border: 3px solid #FF9800;
            position: relative;
            margin: 20px 0;
        }

        #main::before {
            content: 'MAIN Handler';
            position: absolute;
            top: 5px;
            left: 10px;
            color: #FF9800;
            font-weight: bold;
            font-size: 12px;
        }

        #section {
            padding: 40px;
            background: #d0d0d0;
            border: 3px solid #9C27B0;
            position: relative;
            margin: 20px 0;
        }

        #section::before {
            content: 'SECTION Handler';
            position: absolute;
            top: 5px;
            left: 10px;
            color: #9C27B0;
            font-weight: bold;
            font-size: 12px;
        }

        button {
            background: #FF5722;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #E64A19;
            transform: scale(1.05);
        }

        .log {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 540px;
            height: 250px;
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 10px;
            border-radius: 8px;
            overflow: scroll;
            white-space: nowrap;
            border: 2px solid #00ff00;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            opacity: 0.95;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
        }

        .handler-body { color: #4CAF50; }
        .handler-app { color: #2196F3; }
        .handler-main { color: #FF9800; }
        .handler-section { color: #9C27B0; }
        .button-action { color: #FF5722; }

        .title {
            text-align: center;
            margin-bottom: 30px;
        }

        .explanation {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
        }

        .clear-log {
            position: fixed;
            bottom: 290px;
            right: 10px;
            background: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1001;
        }
    </style>
</head>
<body>
    <div class="title">
        <h1>üéØ Multi-Handler System Demo</h1>
        <p><strong>Revolutionary Event Delegation with Closest-Match Resolution</strong></p>
    </div>

    <div class="explanation">
        <h3>üöÄ How it works:</h3>
        <ul>
            <li><strong>4 click handlers</strong> on different DOM levels with closest-match resolution</li>
            <li><strong>Throttled scroll</strong> handler (350ms) for smooth performance</li>
            <li><strong>Debounced input</strong> handler (300ms) for search-as-you-type</li>
            <li><strong>Buttons</strong> have individual <code>data-action</code> functions</li>
            <li><strong>Click anywhere</strong> - only the CLOSEST handler executes!</li>
            <li><strong>Traditional libraries:</strong> Multiple listeners = memory leak city</li>
            <li><strong>YpsilonEventHandler:</strong> Intelligent unified system = quantum efficiency!</li>
        </ul>
    </div>

    <button data-action="bodyButtonAction">Body Level Button</button>
    <input type="text" id="bodyInput" placeholder="Body level input..." style="margin-left: 10px; padding: 8px; border: 1px solid #4CAF50; border-radius: 4px;">

    <!-- Throttle/Debounce Demo Section -->
    <div style="background: #e3f2fd; padding: 20px; margin: 20px 0; border-radius: 8px; border: 2px solid #1976d2;">
        <h4 style="color: #1976d2; margin-top: 0;">‚ö° Throttle & Debounce Demo</h4>

        <div style="margin-bottom: 15px;">
            <label for="searchInput" style="font-weight: bold; color: #1976d2;">üîç Debounced Search (300ms delay):</label><br>
            <input type="text" id="searchInput" placeholder="Type to see debounced search..."
                   style="width: 300px; padding: 8px; margin-top: 5px; border: 1px solid #1976d2; border-radius: 4px;">
        </div>

        <div class="scroll-zone" style="background: white; border: 1px solid #1976d2; height: 150px; overflow-y: auto; padding: 10px; border-radius: 4px;">
            <div style="font-weight: bold; color: #1976d2; margin-bottom: 10px;">üìä Throttled Scroll Zone (350ms throttle):</div>
            <div style="height: 800px; background: linear-gradient(to bottom, #e3f2fd, #bbdefb, #90caf9, #64b5f6, #42a5f5);">
                <p style="padding: 20px; color: #1976d2;">Scroll this area to see throttled scroll events!</p>
                <p style="padding: 20px;">Traditional approach: 60+ scroll events per second = performance killer</p>
                <p style="padding: 20px;">YpsilonEventHandler: Throttled to <b>X</b> events per second = smooth performance!</p>
                <p style="padding: 20px;">Keep scrolling to see the difference in the event log...</p>
            </div>
        </div>
    </div>

    <div id="app">
        <button data-action="appButtonAction">App Level Button</button>
        <input type="text" id="appInput" placeholder="App level input..." style="margin-left: 10px; padding: 8px; border: 1px solid #2196F3; border-radius: 4px;">

        <div id="main">
            <button data-action="mainButtonAction">Main Level Button</button>
            <button data-action="mainButtonActionTwo">Main Level 2</button>
            <button data-action="mainButtonActionThree">Main Level 3</button>
            <input type="text" id="mainInput" placeholder="Main level input..." style="margin-left: 10px; padding: 8px; border: 1px solid #FF9800; border-radius: 4px;">

            <div id="section">
                <button data-action="sectionButtonAction">Section Level Button</button>
                <button data-cmd="newCustomAction">NEW: Custom data-cmd Button</button>
                <input type="text" id="sectionInput" placeholder="Section level input..." style="margin-left: 10px; padding: 8px; border: 1px solid #9C27B0; border-radius: 4px;">
            </div>
        </div>
    </div>

    <div class="log" id="eventLog"></div>

    <button class="clear-log" onclick="clearLog()">Clear Log</button>

    <script src="https://cdn.jsdelivr.net/npm/ypsilon-event-handler@1.7.0/ypsilon-event-handler.min.js"></script>
    <script>
        class AdvancedHandler extends YpsilonEventHandler {
            constructor() {
                super({
                    'window':        [{ type: 'load',   options: { once: true, passive: true } }], // auto routed to `handleLoad()`
                    'body':          [{ type: 'click',  handler: 'bodyClick' }],
                    '#app':          [{ type: 'click',  handler: 'appClick' }],
                    '#main':         [{ type: 'click',  handler: 'mainClick' }],
                    '#section':      [{ type: 'click',  handler: 'sectionClick' }],
                    '#searchInput':  [{ type: 'input',  handler: 'handleDebouncedSearch', debounce: 300 }],
                    '#bodyInput':    [{ type: 'input',  handler: 'handleBodyInput',       debounce: 300 }],
                    '#appInput':     [{ type: 'input',  handler: 'handleAppInput',        debounce: 300 }],
                    '#mainInput':    [{ type: 'input',  handler: 'handleMainInput',       debounce: 300 }],
                    '#sectionInput': [{ type: 'input',  handler: 'handleSectionInput',    debounce: 300 }],
                    '.scroll-zone':  [{ type: 'scroll', handler: 'handleThrottledScroll', throttle: 350 }],
                }, {
                    // Configurable actionable target patterns
                    actionableAttributes:    ['data-action', 'data-cmd'], // Support both data-action and data-cmd
                    actionableClasses:       ['actionable', 'clickable'], // Support .actionable and .clickable classes
                    actionableTags:          ['BUTTON', 'A', 'INPUT'],    // Support buttons, links, and inputs
                    enableActionableTargets: true,                        // Enable actionable target resolution
                    /**
                     * If you only support actionableAttributes, set the remaining options to empty arrays */
                    // actionableClasses: [],
                    // actionableTags:    [],
                });
            }

            // Add debounced initial welcome message
            handleLoad(event) {
                clearLog();
                this.logEvent('System', 'Multi-Handler Demo Ready!', document.body, '#ddf730');
            }

            // Handler methods
            bodyClick(event, target) {
                // If it's a button, handle it directly without logging parent handler
                if (target.dataset.action || target.dataset.cmd) {
                    this.executeButtonAction(event, target);
                    return;
                }
                this.logEvent('BODY Handler', 'bodyClick', target, '#4CAF50');
                this.executeButtonAction(event, target);
            }

            appClick(event, target) {
                // If it's a button, handle it directly without logging parent handler
                if (target.dataset.action || target.dataset.cmd) {
                    this.executeButtonAction(event, target);
                    return;
                }
                this.logEvent('APP Handler', 'appClick', target, '#2196F3');
                this.executeButtonAction(event, target);
            }

            mainClick(event, target) {
                // If it's a button, handle it directly without logging parent handler
                if (target.dataset.action || target.dataset.cmd) {
                    this.executeButtonAction(event, target);
                    return;
                }
                this.logEvent('MAIN Handler', 'mainClick', target, '#FF9800');
                this.executeButtonAction(event, target);
            }

            sectionClick(event, target) {
                // If it's a button, handle it directly without logging parent handler
                if (target.dataset.action || target.dataset.cmd) {
                    this.executeButtonAction(event, target);
                    return;
                }
                this.logEvent('SECTION Handler', 'sectionClick', target, '#9C27B0');
                this.executeButtonAction(event, target);
            }

            // Button action methods
            bodyButtonAction(target, event) {
                this.logEvent('Button Action', 'bodyButtonAction', target, '#FF5722');
            }

            appButtonAction(target, event) {
                this.logEvent('Button Action', 'appButtonAction', target, '#FF5722');
            }

            mainButtonAction(target, event) {
                this.logEvent('Button Action 1', 'mainButtonAction', target, '#FF5722');
            }

            mainButtonActionTwo(target, event) {
                this.logEvent('Button Action 2', 'mainButtonActionTwo', target, '#ff001f');
            }

            mainButtonActionThree(target, event) {
                this.logEvent('Button Action 3', 'mainButtonActionThree', target, '#f5f60b');
            }

            sectionButtonAction(target, event) {
                this.logEvent('Button Action', 'sectionButtonAction', target, '#FF5722');
            }

            // Custom data-cmd handler to demonstrate configurable actionable patterns
            newCustomAction(target, event) {
                this.logEvent('üöÄ CUSTOM CMD', 'newCustomAction', target, '#FF1744');
            }

            // Throttle/Debounce handlers
            handleDebouncedSearch(event, target) {
                const query = target.value.trim();
                this.logEvent('Debounced Search', `"${query || '(empty)'}"`, target, '#1976d2');
            }

            handleThrottledScroll(event, target) {
                const scrollTop = Math.round(target.scrollTop);
                const scrollHeight = target.scrollHeight - target.clientHeight;
                const scrollPercent = scrollHeight > 0 ? Math.round((scrollTop / scrollHeight) * 100) : 0;
                this.logEvent('Throttled Scroll', `${scrollPercent}% (${scrollTop}px)`, target, '#1976d2');
            }

            handleBodyInput(event, target) {
                const query = target.value.trim();
                this.logEvent('Body Input', `"${query || '(empty)'}"`, target, '#4CAF50');
            }

            handleAppInput(event, target) {
                const query = target.value.trim();
                this.logEvent('App Input', `"${query || '(empty)'}"`, target, '#2196F3');
            }

            handleMainInput(event, target) {
                const query = target.value.trim();
                this.logEvent('Main Input', `"${query || '(empty)'}"`, target, '#FF9800');
            }

            handleSectionInput(event, target) {
                const query = target.value.trim();
                this.logEvent('Section Input', `"${query || '(empty)'}"`, target, '#9C27B0');
            }

            // Helper methods
            executeButtonAction(event, target) {
                // Check for data-action attribute
                const action = target.dataset.action;
                if (action && typeof this[action] === 'function') {
                    event.stopPropagation(); // ‚úÖ Stop bubbling BEFORE button action
                    this[action](target, event);
                    return; // ‚úÖ Stop processing after executing button action
                }

                // NEW: Check for data-cmd attribute (configurable actionable pattern)
                const cmd = target.dataset.cmd;
                if (cmd && typeof this[cmd] === 'function') {
                    event.stopPropagation(); // ‚úÖ Stop bubbling BEFORE button action
                    this[cmd](target, event);
                    return; // ‚úÖ Stop processing after executing button action
                }
            }

            logEvent(handlerType, methodName, target, color) {
                const log = document.getElementById('eventLog');
                const timestamp = new Date().toLocaleTimeString();
                const targetInfo = target.tagName.toLowerCase() +
                    (target.id ? `#${target.id}` : '') +
                    (target.dataset.action ? `[action:${target.dataset.action}]` : '') +
                    (target.dataset.cmd ? `[cmd:${target.dataset.cmd}]` : '');

                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.innerHTML = `
                    <span style="color: ${color}; font-weight: bold;">[${timestamp}]</span>
                    <span style="color: ${color};">${handlerType}</span> ‚Üí
                    <span style="color: white;">${methodName}()</span> ‚Üí
                    <span style="color: #ccc;">${targetInfo}</span>
                `;

                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
            }
        }

        // Initialize the demo
        const handler = new AdvancedHandler();

        function clearLog() {
            const log = document.getElementById('eventLog');
            log.innerHTML = `
                <div style="color: #00ff00; font-weight: bold; margin-bottom: 10px;">üåå QUANTUM EVENT LOG üåå</div>
                <div title="Watch the magic: Only closest handler executes!" style="color: #f1e9e9; font-size: 13px; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #443f3f; line-height: 1.2;">
                    Click anywhere to see closest-match resolution!
                </div>
            `;
        }
    </script>

    <div id="flexing" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; margin: 30px 0; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">

        <h2 style="text-align: center; font-size: 2rem; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">üéñÔ∏è Revolutionary Multi-Handler System</h2>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 20px 0;">
            <div>
                <h3 style="color: #ffeb3b; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">üî• What You Just Experienced:</h3>
                <ul style="line-height: 1.8; font-size: 1.1rem;">
                    <li><strong>4 Event Listeners</strong><br>- handling unlimited elements</li>
                    <li><strong>DOM Scoping System</strong><br> - like variable scoping but for events!</li>
                    <li><strong>Closest-Match Resolution</strong><br> - automatically picks the right handler</li>
                    <li><strong>Zero Configuration</strong><br> - works based on DOM hierarchy</li>
                    <li><strong>O(1) Performance</strong><br> - distance caching makes it lightning fast</li>
                </ul>
            </div>
            <div>
                <h3 style="color: #ffeb3b; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">üß† It's Like Variable Scoping!</h3>
                <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 1rem;">
                    <div style="color: #4CAF50;">// JavaScript Scoping</div>
                    <div>function body() {</div>
                    <div>&nbsp;&nbsp;function app() {</div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;function main() {</div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function section() {</div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(x); <span style="color: #ffeb3b;">// Finds closest 'x'</span></div>
                    <div style="margin-top: 10px; color: #4CAF50;">// YpsilonEventHandler Scoping</div>
                    <div>&lt;body&gt; <span style="color: #ffeb3b;">// Global handler</span></div>
                    <div>&nbsp;&nbsp;&lt;div id="app"&gt; <span style="color: #ffeb3b;">// App handler</span></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&lt;div id="main"&gt; <span style="color: #ffeb3b;">// Main handler</span></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div id="section"&gt; <span style="color: #ffeb3b;">// Section handler</span></div>
                    <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;button /&gt; <span style="color: #ffeb3b;">// Finds closest handler!</span></div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 25px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
            <h3 style="color: #ffeb3b; margin-bottom: 15px;">‚ö° The Revolutionary Code</h3>
            <pre class="auto-height" style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; text-align: left; font-size: 1rem;">
<span style="color: #4CAF50;">// Only 4 listeners for infinite elements!</span>
constructor() {
    super({
        <span style="color: #65e86a;">'body'</span>:     [{ type: <span style="color: #ffeb3b;">'click'</span>, handler: <span style="color: #ffeb3b;">'bodyClick'</span> }],   <span style="color: #888;">// Global scope</span>
        <span style="color: #8bc4f1;">'#app'</span>:     [{ type: <span style="color: #ffeb3b;">'click'</span>, handler: <span style="color: #ffeb3b;">'appClick'</span> }],    <span style="color: #888;">// App scope</span>
        <span style="color: #FF9800;">'#main'</span>:    [{ type: <span style="color: #ffeb3b;">'click'</span>, handler: <span style="color: #ffeb3b;">'mainClick'</span> }],   <span style="color: #888;">// Main scope</span>
        <span style="color: #f665e3;">'#section'</span>: [{ type: <span style="color: #ffeb3b;">'click'</span>, handler: <span style="color: #ffeb3b;">'sectionClick'</span> }] <span style="color: #888;">// Section scope</span>
    }, {
        <span style="color: #4CAF50;">// Configurable actionable patterns</span>
        actionableAttributes: [<span style="color: #ffeb3b;">'data-action'</span>, <span style="color: #ffeb3b;">'data-cmd'</span>],
        actionableClasses:    [<span style="color: #ffeb3b;">'actionable'</span>, <span style="color: #ffeb3b;">'clickable'</span>],
        actionableTags:       [<span style="color: #ffeb3b;">'BUTTON'</span>, <span style="color: #ffeb3b;">'A'</span>, <span style="color: #ffeb3b;">'INPUT'</span>]
    });
}</pre>
        </div>

        <div style="text-align: center; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; border: 2px solid #ffeb3b;">
            <h3 style="color: #ffeb3b; margin-bottom: 10px;">üèÜ World's First DOM Event Scoping System</h3>
            <p style="font-size: 1.2rem; margin: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">
                <strong>No other JavaScript library offers this level of intelligent event delegation!</strong><br>
                <em style="display: block;margin-top: 15px;color: #ffeb3b;">DeepSeek rated it 11/10 - "mathematically better than perfect"</em>
            </p>
        </div>
    </div>

    <div class="flex-center-center src-nav" style="padding: 1rem 0">
        <small>¬© Engin Ypsilon &amp; Claude Van DOM</small> |
        <a href="./index.html">Examples</a> |
        <a href="./features/index.html">Features</a> |
        <a href="https://github.com/eypsilon/YpsilonEventHandler">github</a> |
        <a href="https://www.npmjs.com/package/ypsilon-event-handler">npm</a>
    </div>

</body>
</html>